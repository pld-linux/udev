#!/bin/sh
if [ -z "$SUBSYSTEM" ]; then
    echo "SUBSYSTEM not defined, exiting"
    exit -1
fi

MAX_LOOPS=1024
UDEV_RULES_FILE=/etc/udev/rules.d/60-persistent-${SUBSYSTEM}.rules
if [ $SUBSYSTEM = "net" ]; then
    TARGET="NAME"
    ADD=""
else
    TARGET="SYMLINK"
    ADD="+"
fi

read_rules() {
    if [ ! -f $UDEV_RULES_FILE ]; then
	cat > $UDEV_RULES_FILE <<EOF
# autogenerated udev persistent rules for $SUBSYSTEM subsystem
#
EOF
    fi
    EXISTING=`sed -ne "/^[[:space:]]*#.*/b; s/.*$TARGET$ADD=\"\([^\"]*\)\".*/\1/; T; p" $UDEV_RULES_FILE | sort -u`
}
